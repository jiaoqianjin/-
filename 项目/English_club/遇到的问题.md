

# 遇到的问题

## 0. 项目规范

1. 逗号后加空格
2. 文件命名统一规范（大写或者小写）
3. 命名统一规范 （下划线或横杆

## 1. Flyio封装API接口



## 2. Gitlab 提交代码

```bash
dell@DESKTOP-D0R7RN5 MINGW64 /e/project
$ git clone ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git
Cloning into 'winner_club_xcx'...
remote: Enumerating objects: 106, done.
remote: Counting objects: 100% (106/106), done.
remote: Compressing objects: 100% (70/70), done.
remote: Total 106 (delta 0), reused 103 (delta 0), pack-reused 0
Receiving objects: 100% (106/106), 139.48 KiB | 3.98 MiB/s, done.

dell@DESKTOP-D0R7RN5 MINGW64 /e/project
$ cd winner_club_xcx

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git branch
* develop

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git branch -a
* develop
  remotes/origin/HEAD -> origin/develop
  remotes/origin/develop
  remotes/origin/master

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote -v
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (fetch)
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (push)

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote add upstream  ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote -v
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (fetch)
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (push)
upstream        ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git (fetch)
upstream        ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git (push)

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git checkout -b test
Switched to a new branch 'test'

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git branch
  develop
* test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ ls
App.vue      main.js        pages/      README.en.md  static/
components/  manifest.json  pages.json  README.md     uni.scss

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ vim README.md

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git status
On branch test
nothing to commit, working tree clean

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git add .

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git commit -m "first commit"
On branch test
nothing to commit, working tree clean

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git remote
origin
upstream

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git pull upstream develop
From ssh://gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx
 * branch            develop    -> FETCH_HEAD
 * [new branch]      develop    -> upstream/develop
Already up to date.

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git branch
  develop
* test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git push origin HEAD:test
Total 0 (delta 0), reused 0 (delta 0)
remote:
remote: To create a merge request for test, visit:
remote:   http://gitlab.marchsoft.cn/jiaoqianjin/winner_club_xcx/-/merge_requests/new?merge_request%5Bsource_branch%5D=test
remote:
To ssh://gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git
 * [new branch]      HEAD -> test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git pull upstream develop
From ssh://gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx
 * branch            develop    -> FETCH_HEAD
Already up to date.

git brach

git checkout develop

git status

git pull upstream develop

git status

```

## 3. uni-app实现跳转



## 4. uni-app实现音频



## 5. uni-app 实现一键登录

```javascript
wxGetUserInfo: function (infoRes) {
        console.log(infoRes)
				let _self = this;
				if (!infoRes.detail.iv) {
          uni.showToast({
            title: "您取消了授权",
          	icon: "none",
          });
				} else {
					//授权成功
					uni.showLoading({
						mask: true,
						title: "正在授权中",
						complete: function() {
							//调用登录，获取code
							uni.login({
								provider: 'weixin',
								success: function(loginRes) {
                  console.log(loginRes)
									//得到用户信息 
									uni.request({
										url: 'http://192.168.62.184:8090/api/user/wx/login',
										method: 'POST',
										data: {
                      avatar: infoRes.detail.userInfo.avatarUrl, 
                      code: loginRes.code,// 临时登录凭证
                      encryptedData: infoRes.detail.encryptedData, // 用户敏感信息
                      iv: infoRes.detail.iv ,// 解密算法的向量
                      nickName: infoRes.detail.userInfo.nickName,
										},
										success: (res) => {
                      console.log(res)
											if (res.data.id) {
                        console.log(res)
												//写入缓存
												uni.setStorage({
													key: 'wxUser',
													data: res.data,
													success: function() {
														//修改登录状态
														getApp().globalData.isLogin = true;
														//修改上一页的数据
														var pages = getCurrentPages();
														var prevPage = pages[pages.length - 2].setData({
															nickName: infoRes.detail.userInfo.nickName,
															avatar: infoRes.detail.userInfo.avatarUrl,
															isLogin: true
														})
														uni.hideLoading()
														//返回
														_self.uniback(1)
													}
												});
											} else {
												uni.hideLoading()
												uni.showToast({
												  title: "错误 " +res,
													icon: "none",
												});
											}
										},
										fail: function(res) {
											uni.hideLoading()
											uni.showToast({
											  title: "错误 " +res,
												icon: "none",
											});
										}
									});
								},
								fail: function(res) {
									uni.hideLoading()
									uni.showToast({
									  title: "错误 " +res,
										icon: "none",
									});
								}
							});
						}
					})
				}
        // ({
				//   provider: 'weixin',
				//   success: function (loginRes) {
				//     console.log(loginRes.authResult);
				//     // 获取用户信息
				//     uni.getUserInfo({
				// 		provider: 'weixin',
				// 		success: function (infoRes) {
				// 			let formdata={
				// 				nickName: infoRes.userInfo.nickName,
				// 				avatar: '', 
				// 				code: loginRes.code,// 临时登录凭证
				// 				encryptedData: infoRes.detail.encryptedData, // 用户敏感信息
				// 				iv: infoRes.detail.iv // 解密算法的向量
				// 			};
				// 			self.$api.loginWxUser(formdata); // 调用微信授权接口
				// 		}
				//     });
				//   }
				// });
			
```



```javascript
      getPhoneNumber: function(e) {
        console.log(e)
        var args = e;
        var ts = this;
      	if (e.detail.errMsg == 'getPhoneNumber:ok' ) {
          uni.getUserInfo({
            provider: 'weixin',
            success: function (infoRes) {
              console.log(infoRes)
              uni.login({
              	provider: 'weixin',
              	success: function(loginRes) {
                  console.log(loginRes)
              		//得到用户信息 
              		uni.request({
              			url: 'http://192.168.62.184:8090/api/user/wx/login',
              			method: 'POST',
              			data: {
                      avatar: infoRes.userInfo.avatarUrl, 
                      code: loginRes.code,// 临时登录凭证
                      encryptedData: infoRes.encryptedData, // 用户敏感信息
                      iv: infoRes.detail.iv ,// 解密算法的向量
                      nickName: infoRes.userInfo.nickName,
              			},
              			success: (res) => {
                      console.log(res)
              				if (res.data.id) {
                        console.log(res)
              					//写入缓存
              					uni.setStorage({
              						key: 'wxUser',
              						data: res.data,
              						success: function() {
              							//修改登录状态
              							getApp().globalData.isLogin = true;
              							//修改上一页的数据
              							var pages = getCurrentPages();
              							var prevPage = pages[pages.length - 2].setData({
              								nickName: infoRes.detail.userInfo.nickName,
              								avatar: infoRes.detail.userInfo.avatarUrl,
              								isLogin: true
              							})
              							uni.hideLoading()
              							//返回
              							_self.uniback(1)
              						}
              					});
              				} else {
              					uni.hideLoading()
              					uni.showToast({
              					  title: "错误 " +res,
              						icon: "none",
              					});
              				}
              			},
              			fail: function(res) {
              				uni.hideLoading()
              				uni.showToast({
              				  title: "错误 " +res,
              					icon: "none",
              				});
              			}
              		});
              	},
              	fail: function(res) {
              		uni.hideLoading()
              		uni.showToast({
              		  title: "错误 " +res,
              			icon: "none",
              		});
              	}
              });
            },fail:function (fail){console.log("fail:",fail)}
          });    
        } else {
          uni.hideLoading();
          uni.showToast({
            title: '错误',
            icon: "none",
          });
        }
      },
```

```javascript
        getPhoneNumber: function(e) {
          console.log(e)
          var args = e;
          let _self = this;
          if (e.detail.errMsg != 'getPhoneNumber:ok' ) {
            uni.showToast({
              title: "您取消了授权",
              icon: "none",
            });
          } else {
            //授权成功
            uni.showLoading({
              mask: true,
              title: "正在授权中",
              complete: function() {
                uni.getUserInfo({
                  provider: 'weixin',
                  success: function (infoRes) {
                    console.log(infoRes)
                    uni.login({
                      provider: 'weixin',
                      success: function(loginRes) {
                        console.log(loginRes)
                        //得到用户信息 
                        uni.request({
                          url: 'https://47.96.250.239:8090/api/user/wx/login',
                          method: 'POST',
                          data: {
                            avatar: infoRes.userInfo.avatarUrl, 
                            code: loginRes.code,// 临时登录凭证
                            encryptedData: infoRes.encryptedData, // 用户敏感信息
                            iv: infoRes.iv ,// 解密算法的向量
                            nickName: infoRes.userInfo.nickName,
                          },
                          success: (res) => {
                            console.log(res)
                            if (res.data.id) {
                              console.log(res)
                              //写入缓存
                              uni.setStorage({
                                key: 'wxUser',
                                data: res.data,
                                success: function() {
                                  //修改登录状态
                                  getApp().globalData.isLogin = true;
                                  //修改上一页的数据
                                  var pages = getCurrentPages();
                                  var prevPage = pages[pages.length - 2].setData({
                                    nickName: infoRes.detail.userInfo.nickName,
                                    avatar: infoRes.detail.userInfo.avatarUrl,
                                    isLogin: true
                                  })
                                  uni.hideLoading()
                                  //返回
                                  _self.uniback(1)
                                }
                              });
                            } else {
                              uni.hideLoading()
                              uni.showToast({
                                title: "错误 " +res,
                                icon: "none",
                              });
                            }
                          },
                          fail: function(res) {
                            uni.hideLoading()
                            uni.showToast({
                              title: "错误 " +res,
                              icon: "none",
                            });
                          }
                        });
                      },
                      fail: function(res) {
                        uni.hideLoading()
                        uni.showToast({
                          title: "错误 " +res,
                          icon: "none",
                        });
                      }
                    });
                  },fail:function (fail){console.log("fail:",fail)}
                }); 
              },
            })
          }
        }
```

```vue
<template>
	<view>
        <view class="login"></view>
         <button type="primary" class="login-btn" @getphonenumber="goLogin" open-type="getPhoneNumber">一键登录</button>
    </view>
</template>

<script>
	import Card from "./components/card.vue";
    
	export default {
		data() {
			return {
				avatar: '',
				code: '',// 临时登录凭证
				encryptedData: '', // 用户敏感信息
				iv: '' ,// 解密算法的向量
				nickName: '',
                isLogin: false // 判断用户登录状态
			}
		},
		components: {
			Card
		},
		methods: {
            goLogin(e) {
                let _self = this;
                var phoneInfo = e.mp.detail;
                if (phoneInfo.errMsg == "getPhoneNumber:ok") {
                    uni.showLoading({
                        mask: true,
                        duration: 0,
                        message: "登录中..."
                    });
                uni.login({
                    provider: 'weixin',
                    success: function(loginRes) {
                        _self.code = loginRes.code,// 临时登录凭证
                        _self.encryptedData = phoneInfo.encryptedData, // 用户敏感信息
                        _self.iv = phoneInfo.iv // 解密算法的向量
                        _self.login();
                        uni.hideLoading();
                    }
                });
                }else {
                    uni.showToast({
                        title: "您取消了授权 ",
                        icon: 'none'
                    });
                    uni.hideLoading();
                }
            },
            login() {
                let _self = this;
                let formdata = {
                    avatar: '', // 用户头像
                    code: _self.code,// 临时登录凭证
                    encryptedData: _self.encryptedData, // 用户敏感信息
                    iv: _self.iv ,// 解密算法的向量
                    nickName: '', // 用户昵称
                };
                _self.$api.loginWxUser(formdata)
                    .then(res => {
                        console.log(res.data.Authorization)
                        // 将用户的 Token 写入缓存
                        uni.setStorage({
                            key: 'aliToken',
                            data: res.data.Authorization,
                            success: function() {
                                //修改登录状态
                                getApp().globalData.isLogin = true;
                                _self.isLogin = getApp().globalData.isLogin;
                                if (res.data.Authorization) {
                                    // 登录成功，向我的页面传递状态
                                    _self.$emit("getSatus",_self.isLogin);
                                }
                                else {
                                    uni.showToast({
                                        title: "授权失败 ",
                                        icon: 'none'
                                    });
                                }
                            },
                        });
                    })
                    .catch(err => {
                        uni.showToast({
                            title: "登录失败 ",
                            icon: 'none'
                        });
                        uni.hideLoading();
                    });
            },
		}
	}
</script>

<style scoped>
    .login {
        margin: 300rpx auto 0;

    }
    .login-btn {
        width: 400rpx;
        height: 100rpx;
        background-color: #14A7F9;
        color: #FFF;
        font-size: 40rpx;
        text-align: center;
    }
</style>

```

```javascript
                            uni.request({
                                url: 'http://192.168.62.184:8090/api//user/wx/token/get',
								method: 'get',
								data: {
                                    code: loginRes.code,// 临时登录凭证
								},
                                success: res => {
                                    // 将用户的 Token 写入缓存
                                    uni.setStorage({
                                        key: 'aliToken',
                                        data: res.data.Authorization,
                                        success: function() {
                                            let res = _self.$api.getUser();
                                            res.then((data) => {
                                                console.log(data)
                                                uni.setStorageSync('userInfo', data.data.info);
                                            });
                                            //修改登录状态
                                            _self.isLogin = true;
                                        }
                                    });
                                },
                                fail: res => {
                                    
                                }
```



```javas
            // checkLogin() {
            //     const value = uni.getStorageSync('aliToken');
            //     if (value) {
            //         console.log("拿到了token")
            //         //拿到token 查询数据
            //         this.isLogin = true;
            //     } else {
            //         let interceptors = true;
            //         console.log("点击了跳转")
            //         uni.navigateTo({
            //             url:'/pages/mine/login?interceptors=' + interceptors,
            //             animationType: 'pop-in',
            //         })
            //     }         
            // },
```



## 6. 小程序进入我的页面前进行授权检查



## 7. 子父组件传值



## 8. Promise获取的数据如何提取

```javascript
Promise.then((data) => {    
    console.log(data)
});
```



## 9. uni-app 数据缓存

 

## 10. vue中阻止@click事件冒泡



## 11. vue属性props定义方法



## 12. css width自适应宽度百分比

实现div居中，宽度自适应

```css
margin: 0 auto;
width:fit-content
```

