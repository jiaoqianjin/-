

# 遇到的问题

## 0. 项目规范

1. 逗号后加空格
2. 文件命名统一规范（大写或者小写）
3. 命名统一规范 （下划线或横杆）

## 1. Flyio封装API接口

### 1）flyio 是什么?

> 一个支持所有JavaScript运行环境的基于Promise的、支持请求转发、强大的http请求库。可以让您在多个端上尽可能大限度的实现代码复用。

### 2）flyio能干什么？

Fly.js 是一个基于 promise 的，轻量且强大的Javascript http 网络库，它有如下特点：

1. 提供统一的 Promise API。
2. 浏览器环境下，**轻量且非常轻量** 。
3. 支持多种JavaScript 运行环境
4. 支持请求／响应拦截器。
5. 自动转换 JSON 数据。
6. **支持切换底层 Http Engine，可轻松适配各种运行环境**。
7. **浏览器端支持全局Ajax拦截 。**
8. **H5页面内嵌到原生 APP 中时，支持将 http 请求转发到 Native。支持直接请求图片**。

### 3）flyio使用

	1. 安装

使用NPM安装

```shell
npm install flyio
```

2. 微信小程序中引入flyio，新建utils文件夹，在文件夹中新建request.js 

```javascript
let Fly = require("flyio/dist/npm/wx")
let fly = new Fly
```

3. 全局请求配置

```javascript
//设置超时
fly.config.timeout = 30000;
//设置请求基地址
fly.config.baseURL = 'https://uniapp.dcloud.io/api';
```

4. 拦截器

```javascript
// 添加请求拦截器
fly.interceptors.request.use((request) => {
    // 给所有请求添加自定义header，带上token信息让服务器验证用户登陆
    let token = uni.getStorageSync('aliToken');
    request.headers['Authorization'] = token;
    // 在当前页面显示导航条加载动画
    uni.showNavigationBarLoading();
    return request;
})
// 添加响应拦截器，响应拦截器会在then/catch处理之前执行
fly.interceptors.response.use(
    (response) => {
        if (response.data.errorNo != 0) {
            uni.showToast({
                title: response.data.errorInfo,
                icon: 'none',
            });
        }
        uni.hideNavigationBarLoading()
        return response.data; //请求成功之后将返回值返回
    },
    (err) => {
        // 在当前页面隐藏导航条加载动画
        uni.hideNavigationBarLoading()

        if (err.status === 0) {
            uni.showToast({
                title: '网络请求延时',
                icon: "none",
            });
            return Promise.reject(err);
        }
        let code = err.response.status;
		if (code === 401) {
			uni.navigateTo({
				url: "/pages/mine/login?interceptors=1"
			});
		} else if (code === 403) {
			uni.showToast({
			    title: '没有权限',
			    icon: "none",
			});
			return Promise.reject(err);
		} else {
            uni.showToast({
                title: err.response.data.message,
                icon: "none",
            });
            return Promise.reject(err);
        }
    }
)
export default fly;
```

5. 添加api 接口配置，在utils文件夹中新建api.js，引入Fly

```javascript
import fly from './request'

export default {
    // 新增一条打卡记录
    addCheck: (params) => {
        return fly.post('/check/add', params);
    },
    // 获取用户信息
    getUser: () => {
        return fly.get('/user/get');
    },
     // 查询点赞的用户
    getLikeUsers: (params) => {
        return fly.get('/user-like-check/getUsers?id=' + params);
    },
    ...
}
```

6. 挂载api到全局,在main.js中引入挂载

```java
import API from "./utils/api.js"
Vue.prototype.$api = API
```

7. 调用接口

```javascript
let params = {
    // 评论文本
    content: this.content,
    groupId: this.curGroup,
};
this.$api.addCheck(params).then(res => {
         console.log(res)
    })
    .catch(err => {
        console.log(err)
    });

// 调用获取用户信息接口
this.$api.getUser().then(res => {
    console.log(res)
}).catch(err => {
    console.log(err)
})
```





## 2. Gitlab 提交代码

```bash
dell@DESKTOP-D0R7RN5 MINGW64 /e/project
$ git clone ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git
Cloning into 'winner_club_xcx'...
remote: Enumerating objects: 106, done.
remote: Counting objects: 100% (106/106), done.
remote: Compressing objects: 100% (70/70), done.
remote: Total 106 (delta 0), reused 103 (delta 0), pack-reused 0
Receiving objects: 100% (106/106), 139.48 KiB | 3.98 MiB/s, done.

dell@DESKTOP-D0R7RN5 MINGW64 /e/project
$ cd winner_club_xcx

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git branch
* develop

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git branch -a
* develop
  remotes/origin/HEAD -> origin/develop
  remotes/origin/develop
  remotes/origin/master

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote -v
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (fetch)
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (push)

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote add upstream  ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git remote -v
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (fetch)
origin  ssh://git@gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git (push)
upstream        ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git (fetch)
upstream        ssh://git@gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx.git (push)

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (develop)
$ git checkout -b test
Switched to a new branch 'test'

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git branch
  develop
* test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ ls
App.vue      main.js        pages/      README.en.md  static/
components/  manifest.json  pages.json  README.md     uni.scss

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ vim README.md

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git status
On branch test
nothing to commit, working tree clean

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git add .

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git commit -m "first commit"
On branch test
nothing to commit, working tree clean

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git remote
origin
upstream

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git pull upstream develop
From ssh://gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx
 * branch            develop    -> FETCH_HEAD
 * [new branch]      develop    -> upstream/develop
Already up to date.

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git branch
  develop
* test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git push origin HEAD:test
Total 0 (delta 0), reused 0 (delta 0)
remote:
remote: To create a merge request for test, visit:
remote:   http://gitlab.marchsoft.cn/jiaoqianjin/winner_club_xcx/-/merge_requests/new?merge_request%5Bsource_branch%5D=test
remote:
To ssh://gitlab.marchsoft.cn:8022/jiaoqianjin/winner_club_xcx.git
 * [new branch]      HEAD -> test

dell@DESKTOP-D0R7RN5 MINGW64 /e/project/winner_club_xcx (test)
$ git pull upstream develop
From ssh://gitlab.marchsoft.cn:8022/sangjinchao/winner_club_xcx
 * branch            develop    -> FETCH_HEAD
Already up to date.

git brach

git checkout develop

git status

git pull upstream develop

git status

```

## 3. uni-app实现跳转



## 4. uni-app实现图片预览

```vue
<template>
	<view>
        <view v-for="(res, key) in imgArr" :key="key">
            <image 
                :src=" res.url" 
                mode="aspectFill"
                @click="lookImg(imgArr, key)"></image>
    	</view>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				imgArr:[
                    {"url":'https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20200722164518.png'},
                    {"url":'https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20200722164518.png'},
                    {"url":'https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20200722164518.png'}
                ]
			};
		},
		methods: {
			// 预览图片
            lookImg: function(imgArr, val) {
                const urls = imgArr;
                const current = val;
                uni.previewImage({
                    urls,
                    current,
                    longPressActions: {
                        itemList: ['发送给朋友', '保存图片', '收藏'],
                        success: function(data) {
                            console.log('选中了第' + (data.tapIndex + 1) + '个按钮,第' + (data.index + 1) +
                                '张图片');
                        },
                        fail: function(err) {
                            console.log(err.errMsg);
                        }
                    }
                });
            },
		}
	}
</script>
```

效果

<video src="E:\Documents\Apowersoft\ShowMore\20200722_171226.mp4"></video>



## 5. uni-app 实现一键登录

```javascript
wxGetUserInfo: function (infoRes) {
        console.log(infoRes)
				let _self = this;
				if (!infoRes.detail.iv) {
          uni.showToast({
            title: "您取消了授权",
          	icon: "none",
          });
				} else {
					//授权成功
					uni.showLoading({
						mask: true,
						title: "正在授权中",
						complete: function() {
							//调用登录，获取code
							uni.login({
								provider: 'weixin',
								success: function(loginRes) {
                  console.log(loginRes)
									//得到用户信息 
									uni.request({
										url: 'http://192.168.62.184:8090/api/user/wx/login',
										method: 'POST',
										data: {
                      avatar: infoRes.detail.userInfo.avatarUrl, 
                      code: loginRes.code,// 临时登录凭证
                      encryptedData: infoRes.detail.encryptedData, // 用户敏感信息
                      iv: infoRes.detail.iv ,// 解密算法的向量
                      nickName: infoRes.detail.userInfo.nickName,
										},
										success: (res) => {
                      console.log(res)
											if (res.data.id) {
                        console.log(res)
												//写入缓存
												uni.setStorage({
													key: 'wxUser',
													data: res.data,
													success: function() {
														//修改登录状态
														getApp().globalData.isLogin = true;
														//修改上一页的数据
														var pages = getCurrentPages();
														var prevPage = pages[pages.length - 2].setData({
															nickName: infoRes.detail.userInfo.nickName,
															avatar: infoRes.detail.userInfo.avatarUrl,
															isLogin: true
														})
														uni.hideLoading()
														//返回
														_self.uniback(1)
													}
												});
											} else {
												uni.hideLoading()
												uni.showToast({
												  title: "错误 " +res,
													icon: "none",
												});
											}
										},
										fail: function(res) {
											uni.hideLoading()
											uni.showToast({
											  title: "错误 " +res,
												icon: "none",
											});
										}
									});
								},
								fail: function(res) {
									uni.hideLoading()
									uni.showToast({
									  title: "错误 " +res,
										icon: "none",
									});
								}
							});
						}
					})
				}
        // ({
				//   provider: 'weixin',
				//   success: function (loginRes) {
				//     console.log(loginRes.authResult);
				//     // 获取用户信息
				//     uni.getUserInfo({
				// 		provider: 'weixin',
				// 		success: function (infoRes) {
				// 			let formdata={
				// 				nickName: infoRes.userInfo.nickName,
				// 				avatar: '', 
				// 				code: loginRes.code,// 临时登录凭证
				// 				encryptedData: infoRes.detail.encryptedData, // 用户敏感信息
				// 				iv: infoRes.detail.iv // 解密算法的向量
				// 			};
				// 			self.$api.loginWxUser(formdata); // 调用微信授权接口
				// 		}
				//     });
				//   }
				// });
			
```



```javascript
      getPhoneNumber: function(e) {
        console.log(e)
        var args = e;
        var ts = this;
      	if (e.detail.errMsg == 'getPhoneNumber:ok' ) {
          uni.getUserInfo({
            provider: 'weixin',
            success: function (infoRes) {
              console.log(infoRes)
              uni.login({
              	provider: 'weixin',
              	success: function(loginRes) {
                  console.log(loginRes)
              		//得到用户信息 
              		uni.request({
              			url: 'http://192.168.62.184:8090/api/user/wx/login',
              			method: 'POST',
              			data: {
                      avatar: infoRes.userInfo.avatarUrl, 
                      code: loginRes.code,// 临时登录凭证
                      encryptedData: infoRes.encryptedData, // 用户敏感信息
                      iv: infoRes.detail.iv ,// 解密算法的向量
                      nickName: infoRes.userInfo.nickName,
              			},
              			success: (res) => {
                      console.log(res)
              				if (res.data.id) {
                        console.log(res)
              					//写入缓存
              					uni.setStorage({
              						key: 'wxUser',
              						data: res.data,
              						success: function() {
              							//修改登录状态
              							getApp().globalData.isLogin = true;
              							//修改上一页的数据
              							var pages = getCurrentPages();
              							var prevPage = pages[pages.length - 2].setData({
              								nickName: infoRes.detail.userInfo.nickName,
              								avatar: infoRes.detail.userInfo.avatarUrl,
              								isLogin: true
              							})
              							uni.hideLoading()
              							//返回
              							_self.uniback(1)
              						}
              					});
              				} else {
              					uni.hideLoading()
              					uni.showToast({
              					  title: "错误 " +res,
              						icon: "none",
              					});
              				}
              			},
              			fail: function(res) {
              				uni.hideLoading()
              				uni.showToast({
              				  title: "错误 " +res,
              					icon: "none",
              				});
              			}
              		});
              	},
              	fail: function(res) {
              		uni.hideLoading()
              		uni.showToast({
              		  title: "错误 " +res,
              			icon: "none",
              		});
              	}
              });
            },fail:function (fail){console.log("fail:",fail)}
          });    
        } else {
          uni.hideLoading();
          uni.showToast({
            title: '错误',
            icon: "none",
          });
        }
      },
```

```javascript
        getPhoneNumber: function(e) {
          console.log(e)
          var args = e;
          let _self = this;
          if (e.detail.errMsg != 'getPhoneNumber:ok' ) {
            uni.showToast({
              title: "您取消了授权",
              icon: "none",
            });
          } else {
            //授权成功
            uni.showLoading({
              mask: true,
              title: "正在授权中",
              complete: function() {
                uni.getUserInfo({
                  provider: 'weixin',
                  success: function (infoRes) {
                    console.log(infoRes)
                    uni.login({
                      provider: 'weixin',
                      success: function(loginRes) {
                        console.log(loginRes)
                        //得到用户信息 
                        uni.request({
                          url: 'https://47.96.250.239:8090/api/user/wx/login',
                          method: 'POST',
                          data: {
                            avatar: infoRes.userInfo.avatarUrl, 
                            code: loginRes.code,// 临时登录凭证
                            encryptedData: infoRes.encryptedData, // 用户敏感信息
                            iv: infoRes.iv ,// 解密算法的向量
                            nickName: infoRes.userInfo.nickName,
                          },
                          success: (res) => {
                            console.log(res)
                            if (res.data.id) {
                              console.log(res)
                              //写入缓存
                              uni.setStorage({
                                key: 'wxUser',
                                data: res.data,
                                success: function() {
                                  //修改登录状态
                                  getApp().globalData.isLogin = true;
                                  //修改上一页的数据
                                  var pages = getCurrentPages();
                                  var prevPage = pages[pages.length - 2].setData({
                                    nickName: infoRes.detail.userInfo.nickName,
                                    avatar: infoRes.detail.userInfo.avatarUrl,
                                    isLogin: true
                                  })
                                  uni.hideLoading()
                                  //返回
                                  _self.uniback(1)
                                }
                              });
                            } else {
                              uni.hideLoading()
                              uni.showToast({
                                title: "错误 " +res,
                                icon: "none",
                              });
                            }
                          },
                          fail: function(res) {
                            uni.hideLoading()
                            uni.showToast({
                              title: "错误 " +res,
                              icon: "none",
                            });
                          }
                        });
                      },
                      fail: function(res) {
                        uni.hideLoading()
                        uni.showToast({
                          title: "错误 " +res,
                          icon: "none",
                        });
                      }
                    });
                  },fail:function (fail){console.log("fail:",fail)}
                }); 
              },
            })
          }
        }
```

```vue
<template>
	<view>
        <view class="login"></view>
         <button type="primary" class="login-btn" @getphonenumber="goLogin" open-type="getPhoneNumber">一键登录</button>
    </view>
</template>

<script>
	import Card from "./components/card.vue";
    
	export default {
		data() {
			return {
				avatar: '',
				code: '',// 临时登录凭证
				encryptedData: '', // 用户敏感信息
				iv: '' ,// 解密算法的向量
				nickName: '',
                isLogin: false // 判断用户登录状态
			}
		},
		components: {
			Card
		},
		methods: {
            goLogin(e) {
                let _self = this;
                var phoneInfo = e.mp.detail;
                if (phoneInfo.errMsg == "getPhoneNumber:ok") {
                    uni.showLoading({
                        mask: true,
                        duration: 0,
                        message: "登录中..."
                    });
                uni.login({
                    provider: 'weixin',
                    success: function(loginRes) {
                        _self.code = loginRes.code,// 临时登录凭证
                        _self.encryptedData = phoneInfo.encryptedData, // 用户敏感信息
                        _self.iv = phoneInfo.iv // 解密算法的向量
                        _self.login();
                        uni.hideLoading();
                    }
                });
                }else {
                    uni.showToast({
                        title: "您取消了授权 ",
                        icon: 'none'
                    });
                    uni.hideLoading();
                }
            },
            login() {
                let _self = this;
                let formdata = {
                    avatar: '', // 用户头像
                    code: _self.code,// 临时登录凭证
                    encryptedData: _self.encryptedData, // 用户敏感信息
                    iv: _self.iv ,// 解密算法的向量
                    nickName: '', // 用户昵称
                };
                _self.$api.loginWxUser(formdata)
                    .then(res => {
                        console.log(res.data.Authorization)
                        // 将用户的 Token 写入缓存
                        uni.setStorage({
                            key: 'aliToken',
                            data: res.data.Authorization,
                            success: function() {
                                //修改登录状态
                                getApp().globalData.isLogin = true;
                                _self.isLogin = getApp().globalData.isLogin;
                                if (res.data.Authorization) {
                                    // 登录成功，向我的页面传递状态
                                    _self.$emit("getSatus",_self.isLogin);
                                }
                                else {
                                    uni.showToast({
                                        title: "授权失败 ",
                                        icon: 'none'
                                    });
                                }
                            },
                        });
                    })
                    .catch(err => {
                        uni.showToast({
                            title: "登录失败 ",
                            icon: 'none'
                        });
                        uni.hideLoading();
                    });
            },
		}
	}
</script>

<style scoped>
    .login {
        margin: 300rpx auto 0;

    }
    .login-btn {
        width: 400rpx;
        height: 100rpx;
        background-color: #14A7F9;
        color: #FFF;
        font-size: 40rpx;
        text-align: center;
    }
</style>

```

```javascript
                            uni.request({
                                url: 'http://192.168.62.184:8090/api//user/wx/token/get',
								method: 'get',
								data: {
                                    code: loginRes.code,// 临时登录凭证
								},
                                success: res => {
                                    // 将用户的 Token 写入缓存
                                    uni.setStorage({
                                        key: 'aliToken',
                                        data: res.data.Authorization,
                                        success: function() {
                                            let res = _self.$api.getUser();
                                            res.then((data) => {
                                                console.log(data)
                                                uni.setStorageSync('userInfo', data.data.info);
                                            });
                                            //修改登录状态
                                            _self.isLogin = true;
                                        }
                                    });
                                },
                                fail: res => {
                                    
                                }
```



```javas
            // checkLogin() {
            //     const value = uni.getStorageSync('aliToken');
            //     if (value) {
            //         console.log("拿到了token")
            //         //拿到token 查询数据
            //         this.isLogin = true;
            //     } else {
            //         let interceptors = true;
            //         console.log("点击了跳转")
            //         uni.navigateTo({
            //             url:'/pages/mine/login?interceptors=' + interceptors,
            //             animationType: 'pop-in',
            //         })
            //     }         
            // },
```



## 6. 小程序进入我的页面前进行授权检查

```javascript
created() {
    // 有token，不需要处理，继续操作
    if (!getApp().globalData.token || !getApp().globalData.userInfo) {
        // 检查用户登录状态是否过期
        uni.checkSession({
            success: () => {
                // 授权未过期，根据uni.login()得到的code,向后端获取token
                this.getToken();
                uni.showLoading({
                    mask: true,
                });
                console.log("不需要再次授权");
            },
            fail: () => {
                console.log("需要重新授权");
                // 跳转到登录页面
                uni.navigateTo({
				  url: "/pages/login/login"
			  });
            }
        });
    } else {
        console.log("已登录, 重新获取用户信息");
        this.getUserInfo();
        getApp().globalData.isLogin = true;
    }
},
methods: {
    // 授权未过期，根据uni.login()得到的code,向后端获取token
    getToken() {
        uni.login({
            provider: 'weixin',
            success: (loginRes) => {
                this.$api.getToken({code: loginRes.code}).then(res => {
                    // 将用户的 Token 写入缓存
                    try {
                        uni.setStorageSync('aliToken', res.data.Authorization);
                        getApp().globalData.token = res.data.Authorization;
                    } catch(e) {}
                    this.getUserInfo();
                }).catch(() => {
                    uni.hideLoading();
                });
            }
        });
    },
    // 获取用户信息
    getUserInfo() {
        // 获取用户信息，写入本地存储
        this.$api.getUser().then((res) => {
            try {
                getApp().globalData.userInfo = res.data.info;
                getApp().globalData.isLogin = true;
                uni.setStorageSync('userInfo', res.data.info);
            } catch(e) {}
            uni.hideLoading();
        }).catch(() => {
            uni.hideLoading();
        });
    },
}
```

```vue
<template>
    <view>
        <view v-if="interceptors">
            <view class="logo">
                <image class="logo-img" src="../../static/img/avatar.png"></image>
            </view>
            <view class="title"><text>WINNER 英语俱乐部</text></view>
            <button type="primary" class="login-btn" @getphonenumber="goLogin" open-type="getPhoneNumber">一键登录</button>
        </view>
        <view v-else>
            <view class="login"></view>
            <button type="primary" class="login-btn" @getphonenumber="goLogin" open-type="getPhoneNumber">一键登录</button>
        </view>

    </view>
</template>

<script>
    import Card from './components/card.vue';

    export default {
        data() {
            return {
                avatar: '',
                code: '', // 临时登录凭证
                encryptedData: '', // 用户敏感信息
                iv: '', // 解密算法的向量
                nickName: '',
                isLogin: false, // 判断用户登录状态
                interceptors: false
            };
        },
        onLoad(option) {
            this.interceptors = option.interceptors;
            console.log(option.interceptors)
        },
        components: {
            Card
        },

        methods: {

            goLogin(e) {
                console.log("重新登录")
                let _self = this;
                var phoneInfo = e.mp.detail;
                if (phoneInfo.errMsg == 'getPhoneNumber:ok') {
                    uni.showLoading({
                        mask: true,
                        duration: 0,
                        message: '登录中...'
                    });
                    uni.login({
                        provider: 'weixin',
                        success: function(loginRes) {
                            console.log(loginRes)
                            _self.code = loginRes.code, // 临时登录凭证
                            _self.encryptedData = phoneInfo.encryptedData, // 用户敏感信息
                            _self.iv = phoneInfo.iv; // 解密算法的向量
                            _self.login();
                             
                            uni.hideLoading();
                            console.log(loginRes.code)
                        }
                    });
                } else {
                    uni.showToast({
                        title: '您取消了授权 ',
                        icon: 'none'
                    });
                    uni.hideLoading();
                }
            },
            login() {
                let _self = this;
                let formdata = {
                    code: _self.code, // 临时登录凭证
                    encryptedData: _self.encryptedData, // 用户敏感信息
                    iv: _self.iv, // 解密算法的向量
                };
                _self.$api
                    .loginWxUser(formdata)
                    .then(res => {
                        console.log("登录成功")
                        // 将登陆状态加入全局变量
                        getApp().globalData.isLogin = true;
                        getApp().globalData.token = res.data.Authorization;
                       // 将用户的 Token 写入缓存
                        uni.setStorageSync('aliToken', res.data.Authorization);
                        _self.$api.getUser().then((data) => {
                            getApp().globalData.userInfo = data.data.info;
                            uni.setStorageSync('userInfo', data.data.info);
                            _self.isLogin = true
                            uni.$emit('logined');
                            _self.$emit('getSatus', _self.isLogin);
                            // 如果是一键登录页，加跳转
                            if (_self.interceptors) {
                                uni.navigateBack();
                                    }
                                });
                    })
                    .catch(err => {
                        uni.showToast({
                            title: '登录失败 ',
                            icon: 'none'
                        });
                        uni.hideLoading();
                    });
            },
        }
    };
</script>

<style scoped>
    .login {
        margin: 300rpx auto 0;
    }

    .login-btn {
        width: 400rpx;
        height: 100rpx;
        background-color: #14a7f9;
        color: #fff;
        font-size: 40rpx;
        text-align: center;
    }

    .logo {
        margin: 150rpx auto 0;
        text-align: center;
    }

    .logo-img {
        width: 200rpx;
        height: 200rpx;
    }
    .title {
        margin: 30rpx auto;
        color: #000;
        line-height: 100rpx;
        text-align: center;
    }
    .login-btn {
        margin: 75rpx auto;
        width: 500rpx;
        height: 100rpx;
        background-color: #14A7F9;
        color: #FFF;
        line-height: 100rpx;
        text-align: center;
    }
</style>

```





## 7. 子父组件传值

### 1）父组件向子组件传值

父组件

```vue
<template>
	<view>
		<child :message="parent"></child>   <!--使用组件-->
	</view>
</template>

<script>
import child from '../../components/child.vue'  //引入组件
export default {
	// 注册组件
	components:{
		child
	},
	data(){
		return {
            parent: "我是父组件的值"
		}
	},
	methods: {
		
	}
}
</script>
```

子组件

```vue
<template>
	<view>
		<text>{{message}}</text>  <!--我是父组件的值-->
   		<text>{{child}}</text>  <!--我是子组件的值-->
	</view>
</template>

<script>
	export default {
        props:["message"],  //父组件向子组件传值
		data() {
			return {
				child: '我是子组件的值'
			};
		},
		methods: {
			
		}
	}
</script>
```



### 2）子组件向父组件传值

子组件

```vue
<template>
	<view>
		<text @click="onChild">{{child}}</text> <!--增加触发事件-->
	</view>
</template>

<script>
	export default {
		data() {
			return {
				child: '我是子组件的值'
			};
		},
		methods: {
			// 触发事件后的方法
			onChild() {
				this.$emit('onFather',this.child) //(父组件中触发的事件名，要传的变量名)
			}
		}
	}
</script>
```

父组件

```vue
<template>
	<view>
		<child @onFather="getChild"></child>   
	</view>
</template>

<script>
import test from '../../components/test.vue' //引入组件
export default {
	// 注册组件
	components:{
		child
	},
	data(){
		return {
		}
	},
	methods: {
		//接收子组件传来的值
		getChild(e) {
			console.log(e) // 我是子组件的值
		}
	}
}
```

### 3） 父子件调用子组件的方法

子组件

```vue
<template>
	<view>
		<text>{{child}}</text> <!--父组件触发子组件的方法后，值发生改变-->
	</view>
</template>

<script>
	export default {
		data() {
			return {
				child: '我是子组件的值'
			};
		},
		methods: {
			onChild() {
				this.child = "父组件调用了子组件的方法"
			}
		}
	}
</script>
```

父组件

```vue
<template>
	<view>
		<child ref="child"></child>   
        <button @click="userChild">调用子组件的方法</button>
	</view>
</template>

<script>
import test from '../../components/test.vue' //引入组件
export default {
	// 注册组件
	components:{
		child
	},
	data(){
		return {
		}
	},
	methods: {
		//调用子组件的onChild()方法
		userChild() {
			this.$ref.child.onChild();
		}
	}
}
```



## 8. Promise获取的数据如何提取

```javascript
Promise.then((data) => {    
    console.log(data)
});
```



## 9. uni-app 数据缓存

 

## 10. vue中阻止@click事件冒泡

https://cn.vuejs.org/v2/guide/events.html

```html
<!-- 阻止单击事件继续传播 -->
<a v-on:click.stop="doThis"></a>
```



## 11. vue属性props定义方法



## 12. css width自适应宽度百分比

实现div居中，宽度自适应

```css
margin: 0 auto;
width:fit-content
```

## 13. 超出后显示...

```css
overflow: hidden;
text-overflow: ellipsis; /* 超出显示... */
display: -webkit-box;
-webkit-line-clamp: 3;  /* 显示的行数 */
-webkit-box-orient: vertical;
```

