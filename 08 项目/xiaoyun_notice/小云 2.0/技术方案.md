# 小云通知2.0 技术方案

## 迭代背景

小云通知1.0采用**mpvue框架 + vant 组件**，随着需求的不断变更，该方案不再适用于当前的应用场景，并且小程序端的api为**java**语言编写，后台的api为**PHP**语言编写，不方便维护。为了解决这些问题，并在解决这些问题的基础上，优化一些功能，小云通知2.0应运而生。

## 一、小程序

### 1. 技术栈

#### 应用框架

小云1.0  **mpvue**   --> 小云2.0 **uni-app**

#### 组件库

小云1.0 **Vant**  --> 小云2.0  **uni-app**

### 2. 主要功能

1. 推广

   - 用户可通过推广页面，申请使用，通过输入信息，创建根分组，进行其他操作（具有时限）。
   - 个人中心 **分享给好友**  修改为 **推广入口**
2. 联系人

   - 管理员可以创建公共分组（分组内所有用户都可以看到），也可以创建私有分组（只有自己能够看到）
   - 普通用户只能创建私有分组
   - 用户只能查看当前分组及以下分组，不显示上级分组。
3. 创建分组

   - 用户创建分组添加成员有三种方式：
      - 微信邀请，分享给好友或微信群，邀请新用户
      - 从公共分组添加，只能添加添加同级以下，及自己能看到的分组成员
      - 直接录入
   - 创建私有分组，具有人数限制（20人）私有分组只有一级，不可创建子分组。
4. 分组管理

   - 分组创建者可以创建子分组，解散该分组，设置管理员，添加用户，移出用户。
   - 分组管理员的权限不可解散该分组，其他权限都具有。
5. 通知

   - 用户可以使用首页系统通知模板，也可以自己创建通知模板，保存后下次可使用。
   - **自定义模板？** 3.0 大更改。2.0 样式稍作修改
6. 发布通知

   - 用户可利用模板编辑通知，根据不同的模板选择不同的反馈方式。	
     - 编辑反馈按钮的的时候可以选择填写原因，选择后用户点击反馈按钮时需要填写原因。（新）
   - 选择接受人
     - 可以直接选择整个分组，可以选择人，也可以二者并存
     - 选择分组的时候只选择该分组的用户，不包括当前分组下级的分组用户
     - **选择接受人的时候可以选择自己所在分组的上级分组吗？** 不可以。上级分组看不到
   - 通知可设置反馈截止时间，是否允许更改反馈，标记为紧急（紧急的会排在通知列表前边）
7. 消息提醒

   - 通知发出后向选中的接收人发送模板消息提醒
8. 修改通知

   - 通知发布后创建人可以修改，不能修改接收人和反馈按钮
   - 修改通知**发布**按钮改为**确定**
9. 转发通知

   - 所有通知接受者可转发通知，选择新的接收人，但不能对通知进行更改。
   - 转发的入口在 <通知详情页面> **分享给微信群/好友** 添加 **转发** 按钮
10. 管理通知

    - 复制通知
    - ~~现场核销？~~
    - 导出数据，通过邮箱发送
    - 删除通知
    - 添加管理员
11. 我的通知
    - 长按通知可从自己通知列表移出通知
12. 反馈统计
    - 通知**创建者，管理员，转发者**可以看通知反馈，转发者只能看自己转发分组的统计信息
    - 反馈统计展示，全部（不可查看详情），各个分组（点击可查看详情）
    - 根据反馈类型作反馈统计，如果要求填写反馈原因，反馈统计展示原因列（新）
    - 同一反馈统计总人数，根据转发的次数和人数发生改变。
    - 如果接受人是搜索出来选中的，反馈统计分组名为 **定向用户**

### 3.  页面展示

- 首页

![image-20201203173247072](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201203173247.png)



- 编辑通知页

![image-20201204090132539](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201204090140.png)

- 我的通知页面/通知详情

  ![image-20201204214256284](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201204214257.png)

  

  ![image-20201204214452509](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201204214452.png)

  

  - 联系人

  ![image-20201203203246550](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201203203246.png)

  

- 个人中心

![image-20201204091130611](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201204091130.png)

---

## 二、后台

### 1. 技术栈

#### api接口

小云1.0 PHP  --> 小云2.0 JAVA

#### 应用框架

**spme_eladmin**  三月软件通用框架

**Vue_cli**

**Element UI**

### 2. 功能 

#### 1. 管理员登录

- 登录
- 重置密码 ？ 弹出友好提示页面，**联系管理员**

![image-20201203170029306](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201203170036.png)

#### 2. 用户管理

- 根据条件分页查询
- 新增用户
- 修改用户
- 删除（批量）用户

![image-20201203170340431](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201203170340.png)

#### 3. 分组管理 

​	**排序 --> 创建人**

​	**创建日期 --> 截止日期**

- 分页查询分组
- 新增分组
- 修改分组
- 删除（批量）分组

![image-20201203170929754](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20201203170929.png)



---

## 三、后端

### 应用框架

- smpe_admin
  基于 Spring Boot 2.1.0 、 Mybatis_plus、  JWT、Spring Security、redis、

  - 用户管理：提供用户的相关配置，新增用户后，默认密码为123456
  - 角色管理：对权限与菜单进行分配，可根据部门设置角色的数据权限
  - 菜单管理：已实现菜单动态路由，后端可配置化，支持多级菜单
  - 部门管理：可配置系统组织架构，树形表格展示
  - 岗位管理：配置各个部门的职务

- lombok JavaBean处理技术
- Java 工具库：[hutool](https://hutool.cn/docs/#/)

### 小云通知1.0 接口

[小云通知1.0 JAVA接口](http://rap2.taobao.org/repository/editor?id=272440&mod=427702)

[小云通知1.0 PHP接口](https://signup.redclass.cn/doc)

小程序端使用：

```markdown
删除管理员 v1/delete_admin
删除我报名的通知 v1/del_my_notify
删除我报名的通知 v1/del_my_notify   
管理员列表 v1/add_admin
管理员列表 v1/get_admin    
发送邮箱 v1/send_mail
导出数据 v1/export_data
通知核销 v1/check_notify
获取报名人数 v1/notify_use
复制通知 v1/copy_notify
获取用户信息 v1/user
~~编辑通知时，获取通知 v1/modify_notify
~~查看通知 v1/notify_look~~
~~获取单个通知信息 v1/get_notify~~
```



---

## 四、数据迁移

- [ ] 数据库重建后考虑数据迁移

  兼容以前版本，保证数据不丢失。



---

## 五、风险点

### 1. 小程序端

- 数据状态管理

  选中通知接收人和添加用户到分组，都要利用vuex对数据进行共享状态状态管理，数据使用完毕后要及时的清理，避免数据污染。

- 反馈统计

  - 反馈统计要根据分组和不同的通知类型进行统计，通知被转发后，统计的数据要随人数的变动进行相应的改变
  
  - 创建者，管理员，转发者可以查看反馈数据，但是转发者只能看到自己转发分组的统计

### 2. 后台

- 暂无风险点

### 3. 后端

- 分组权限，返回树形结构数据
- 反馈统计

---

## 六、问题清单

### 12.05日问题

1. 谁可以创建公共分组？

   **管理员**

2. 谁可以转发通知？

   **所有通知接收人都可以转发通知**

3. 紧急通知是否配在通知列表的前边？

   **是，按紧急排序**

4. 我的通知列表是否保留长按移除通知？

   **保留**

5. 反馈统计 全部分组可展示详情吗？

   **不可以**

6. 反馈统计谁可以看到？

   **通知创建者，通知管理员，通知转发者(只可以看转发的分组)**

7. 添加通知管理员是保留手动输入用户还是去用户列表？

   **手动输入**

8. 导出数据发送邮箱？

   **保留此功能**

9. 核销功能？

   **去掉**

10. 忘记密码

    **弹出友好界面，联系管理员**

11. 发送通知选择接收人，选分组是选分组下当前的人，还是分组下级的所有人？

    **只选择当前分组内的人**

12. 选择接收人的时候可以选择上级吗？

    **不可以，看不到上级，只能看到本机分组。**

13. 修改通知可以修改接收人吗？

    **不可以**

14. 推广页面从哪进入？

    **我的页面分享给好友修改为推广**

---

### 12.08日问题

1. 反馈按钮输入字数限制？

   **不限制，显示不完用 ... 表示**

2. 我的通知列表长按移除通知是否在已反馈的情况下才允许删除？

   **不限制。但是对于移除的通知，当通过分享进入后仍然具有移除之前的权限**

3. 复制通知之后返回到那个界面？

   **返回上一页**

4. 通知的管理员权限？

   **和通知创建者权限一样**

5. 添加用户直接录入的方式，录入姓名输入错误怎么办？

   **后期可以在联系详情界面添加修改信息**

6. 微信邀请用户？

   **如果邀请用户已注册，授权后直接进行后续的操作；**

   **如果邀请用户未注册，授权后输入姓名进行注册。**

7. 根分组能有几个？不同的根分组怎么展示联系人，通知列表？

   **能有多个根分组，不同的根分组联系人，依次排列显示，通知在一起但是要有标签注明是哪个根分组**

8. 分组名修改入口？

   **删除该分组修改为编辑该分组，点击后弹出修改该分组和删除该分组**

9. 试用期倒计时展示给谁？

   **该根分组的所有用户都显示**

10. 公共分组解散后，该分组的用户还可以使用小程序吗？

    **可以，解散分组后，用户不删除。**