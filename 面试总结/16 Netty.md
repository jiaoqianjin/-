# Netty

## 一、netty是什么

​		由JBOSS提供的基于Java NIO的开源框架，Netty提供异步非阻塞、事件驱动、高性能、高可靠、高可定制性的网络应用程序和工具，可用于开发服务端和客户端。

## 二、为什么选用netty

### 2.1 为什么不选用原生NIO

1. **NIO的类库和API繁杂使用麻烦**，你需要熟练掌握Selectol,ServerSocketChannel, SocketChannel,ByteBuffer 等。
2. 需妥具备其他的额外技能做制垫，例如熟悉Java 多线程编程。这是因为NIO编程涉及到Reactor 模式，你必须对多钱程和网络编程非常如悉，才能编写出高质量的NIO程序。
3. **可靠性能力补齐**， 工作量和难度都非常大。例如客户端面临断连重连、网络间断、半包读写、失败缓存、网络拥塞和异常码流的处理等问题， NI0 编程的特点是功能开发相对容易，但是可靠性能力补齐的工作量和难度都非常大。
4. JDK NIO的BUG，比如epoll bug，这个BUG会在linux上导致cpu 100%，使得nio server/client不可用，这个BUG直到jdk 6u4才解决，但是直到JDK1.7中仍然有这个问题，该问题并未被完全解决，只是发生的频率降低了而已。

   基于上述原因大多数场景下都***不建议直接使原生NIO***，除非你精通NIO编程或者是有特殊的需要，否则作为服务器编程的NIO可能会带来巨大的生产隐患。

### 2.2 为什么使用netty

1. API使用简单，更容易上手，开发门槛低
2. 功能强大，预置了多种编解码功能，支持多种主流协议
3. 定制能力高，可以通过ChannelHandler对通信框架进行灵活地拓展
4. 高性能，与目前多种NIO主流框架相比，Netty综合性能最高
5. 高稳定性，解决了JDK NIO的BUG
6. 经历了大规模的商业应用考验，质量和可靠性都有很好的验证。

Netty是一个高性能、异步事件驱动的NIO框架，它提供了对TCP、UDP和文件传输的支持，作为一个异步NIO框架，Netty的所有IO操作都是异步非阻塞的，通过**Future-Listener机制**，用户可以方便的主动获取或者通过通知机制获得IO操作结果。作为当前最流行的NIO框架，Netty在互联网领域、大数据分布式计算领域、游戏行业、通信行业等获得了广泛的应用，一些业界著名的开源组件也基于Netty的NIO框架构建。

## 三、Java IO

### 3.1 BIO(同步阻塞)

<img src="https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211227103052.png" alt="img" style="zoom:50%;" />

**BIO主要存在以下缺点：**

1. 从线程模型图中可以看到，一连接一线程，由于线程数是有限的，所以这样的模型是非常消耗资源的，最终也导致它不能承受高并发连接的需求
2. 性能低，因为频繁的进行上下文切换，导致CUP利用率低
3. 可靠性差，由于所有的IO操作都是同步的，即使是业务线程也如此，所以业务线程的IO操作也有可能被阻塞，这将导致系统过分依赖网络的实时情况和外部组件的处理能力，可靠性大大降低

上面的原因就是导致早期的高性能服务器为什么不选用JAVA开发，而是选用C/C++的重要原因。

### 3.2 NIO

<img src="https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211227103814.png" alt="img" style="zoom:50%;" />